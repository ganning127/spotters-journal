create table public."AircraftType" (
  icao_type text not null,
  manufacturer text not null,
  type text not null,
  variant text null,
  constraint AircraftType_pkey primary key (icao_type)
) TABLESPACE pg_default;

create table public."Airline" (
  code text not null,
  name text not null,
  created_at timestamp with time zone null default now(),
  reg_suffix text[] null,
  reg_prefix text[] null,
  brand_color text null,
  constraint Airline_pkey primary key (code)
) TABLESPACE pg_default;

create table public."Airport" (
  icao_code text not null,
  name text not null,
  latitude real null,
  longitude real null,
  elevation smallint null,
  state text null,
  country text null,
  constraint Airport_pkey primary key (icao_code)
) TABLESPACE pg_default;

create table public."Photo" (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone null default now(),
  airport_code text null,
  user_id bigint not null,
  image_url text not null,
  taken_at timestamp with time zone null,
  shutter_speed text null,
  iso integer null,
  aperture text null,
  camera_model text null,
  focal_length text null,
  uuid_rh uuid null,
  constraint Photo_pkey primary key (id),
  constraint Photo_airport_code_fkey foreign KEY (airport_code) references "Airport" (icao_code),
  constraint Photo_user_id_fkey foreign KEY (user_id) references "User" (id),
  constraint Photo_uuid_rh_fkey foreign KEY (uuid_rh) references "RegistrationHistory" (uuid_rh)
) TABLESPACE pg_default;

create table public."RegistrationHistory" (
  uuid_rh uuid not null default extensions.uuid_generate_v4 (),
  uuid_sa uuid null,
  registration text not null,
  airline text null,
  is_current boolean null default true,
  created_at timestamp with time zone null default now(),
  constraint RegistrationHistory_pkey primary key (uuid_rh),
  constraint RegistrationHistory_airline_fkey foreign KEY (airline) references "Airline" (code),
  constraint RegistrationHistory_uuid_sa_fkey foreign KEY (uuid_sa) references "SpecificAircraft" (uuid) on delete CASCADE
) TABLESPACE pg_default;

create index IF not exists idx_reghist_uuid_sa on public."RegistrationHistory" using btree (uuid_sa) TABLESPACE pg_default;

create table public."SpecificAircraft" (
  uuid uuid not null default extensions.uuid_generate_v4 (),
  icao_type text null,
  manufactured_date date null,
  constraint SpecificAircraft_pkey1 primary key (uuid),
  constraint SpecificAircraft_icao_type_fkey foreign KEY (icao_type) references "AircraftType" (icao_type)
) TABLESPACE pg_default;

create index IF not exists idx_specific_aircraft_icao_type on public."SpecificAircraft" using btree (icao_type) TABLESPACE pg_default;

create table public."User" (
  id bigint generated by default as identity not null,
  username text not null,
  password_hash text not null,
  created_at timestamp with time zone null default now(),
  type text null default 'user'::text,
  constraint User_pkey primary key (id),
  constraint User_username_key unique (username),
  constraint User_type_check check ((type = any (array['admin'::text, 'user'::text])))
) TABLESPACE pg_default;